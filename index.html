<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Obsidian Architect: Precision Master</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Bangers&family=Fredoka+One&family=Short+Stack&family=Patrick+Hand&display=swap" rel="stylesheet">
    <link href="https://fonts.cdnfonts.com/css/kg-red-hands" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    
    <style>
        :root {
            --bg: #000;
            --glass: rgba(18, 18, 18, 0.85);
            --accent: #007AFF;
            --border: rgba(255, 255, 255, 0.12);
            --anim: all 0.4s cubic-bezier(0.19, 1, 0.22, 1);
        }

        body { 
            margin: 0; background: var(--bg); color: #fff; 
            font-family: 'Inter', sans-serif; height: 100vh; 
            display: flex; overflow: hidden; touch-action: none;
        }

        /* --- PILL SYSTEM --- */
        .pill-menu {
            position: fixed;
            background: var(--glass); 
            backdrop-filter: blur(50px); -webkit-backdrop-filter: blur(50px);
            border: 1px solid var(--border); 
            border-radius: 25px; 
            padding: 12px; 
            box-shadow: 0 15px 45px rgba(0,0,0,0.6); 
            z-index: 2000; 
            display: flex; 
            align-items: center; 
            gap: 15px;
            cursor: grab;
            user-select: none;
            min-width: 100px; min-height: 40px;
        }

        .pill-menu.active-drag { cursor: grabbing; scale: 0.95; opacity: 0.8; transition: scale 0.2s; }
        .dir-row { flex-direction: row; }
        .dir-col { flex-direction: column; align-items: stretch; }

        .pill-handle {
            position: absolute; right: 4px; bottom: 4px; width: 12px; height: 12px;
            cursor: nwse-resize; background: linear-gradient(135deg, transparent 50%, rgba(255,255,255,0.2) 50%);
            border-radius: 2px;
        }

        /* Redesigned Ribbon Style */
        #top-nav { 
            top: 20px; 
            left: 50%; 
            transform: translateX(-50%); 
            width: auto; 
            min-width: 400px;
            justify-content: center; 
            padding: 10px 25px;
            border-color: rgba(0, 122, 255, 0.3);
        }

        .attribution-text {
            font-size: 9px;
            color: rgba(255,255,255,0.5);
            text-align: center;
            font-weight: 400;
            line-height: 1.2;
            max-width: 150px;
        }

        #edit-ribbon { bottom: 20px; left: 50%; transform: translateX(-50%); display: none; }
        #left-panel { left: 20px; top: 100px; width: 180px; height: 400px; }
        #right-panel { right: 20px; top: 100px; width: 200px; height: 600px; }

        /* --- CANVAS & STAGE --- */
        #stage { 
            flex-grow: 1; 
            display: flex; 
            justify-content: center; 
            align-items: flex-start; 
            z-index: 1; 
            overflow: auto; 
            padding: 100px 0;
            background: radial-gradient(circle, #1a1a1a 1px, transparent 1px);
            background-size: 30px 30px;
        }
        #canvas {
            width: 595px; height: 842px; background: #fff; position: relative;
            box-shadow: 0 0 100px rgba(0,0,0,1); overflow: hidden; border-radius: 4px;
            flex-shrink: 0;
        }
        
        #objects-layer { position: absolute; inset: 0; pointer-events: none; }

        .element { 
            position: absolute; cursor: move; padding: 5px; box-sizing: border-box; 
            touch-action: none; pointer-events: auto; 
        }
        .element.selected { border: 2px solid var(--accent); border-radius: 4px; z-index: 999 !important; }
        .element img { width: 100%; pointer-events: none; display: block; }

        .resizer { position: absolute; width: 18px; height: 18px; background: #fff; border: 2px solid var(--accent); border-radius: 50%; right: -9px; bottom: -9px; cursor: nwse-resize; display: none; z-index: 1001; }
        .rot-handle { position: absolute; width: 18px; height: 18px; background: #34C759; border: 2px solid #fff; border-radius: 50%; top: -35px; left: 50%; transform: translateX(-50%); cursor: crosshair; display: none; z-index: 1001; }
        .element.selected .resizer, .element.selected .rot-handle { display: block; }

        /* --- LAYER LIST STYLES --- */
        #layer-container {
            margin-top: 15px;
            max-height: 150px;
            overflow-y: auto;
            border-top: 1px solid var(--border);
            padding-top: 10px;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .layer-item {
            background: rgba(255,255,255,0.05);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: grab;
            border: 1px solid transparent;
            transition: 0.2s;
        }
        .layer-item:hover { background: rgba(255,255,255,0.1); }
        .layer-item.active { border-color: var(--accent); background: rgba(0,122,255,0.15); }
        .layer-item span { pointer-events: none; }

        .btn { background: var(--accent); color: white; border: none; padding: 8px 12px; border-radius: 50px; cursor: pointer; font-weight: 600; font-size: 10px; transition: 0.2s; white-space: nowrap; outline: none; }
        .btn:active { transform: scale(0.9); }
        .btn-dark { background: rgba(255,255,255,0.08); color: #fff; border: 1px solid var(--border); }
        
        .label { font-size: 8px; text-transform: uppercase; color: rgba(255,255,255,0.4); letter-spacing: 1px; margin-bottom: 4px; pointer-events: none; }
        .page-dot { width: 10px; height: 10px; background: rgba(255,255,255,0.2); border-radius: 50%; cursor: pointer; transition: 0.3s; }
        .page-dot.active { background: var(--accent); transform: scale(1.4); }
        .library-scroll { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; overflow-y: auto; scrollbar-width: none; }
        .lib-thumb { width: 100%; aspect-ratio: 1/1; object-fit: cover; border-radius: 8px; cursor: pointer; border: 1px solid transparent; }
        
        .font-select { background: #333; color: white; border: 1px solid var(--border); border-radius: 5px; font-size: 10px; padding: 2px; cursor: pointer; }
        .color-input { width:30px; height:20px; border:none; background:none; cursor:pointer; padding:0; }
    </style>
</head>
<body>

<div id="top-nav" class="pill-menu dir-row">
    <div class="attribution-text">
        Safaa Saad Al Ghuwariyah kindergarten
    </div>
    
    <div id="dot-container" style="display: flex; gap: 12px; padding: 0 10px; border-left: 1px solid var(--border); border-right: 1px solid var(--border);">
        <div class="page-dot active" onclick="jumpToPage(0)"></div>
    </div>

    <button class="btn" style="background: #5856D6; padding: 8px 20px;" onclick="exportPDF(); this.blur();">EXPORT PDF</button>
    <div class="pill-handle"></div>
</div>

<div id="edit-ribbon" class="pill-menu dir-row">
    <div style="display:flex; flex-direction:column; align-items:center;">
        <span class="label">OPACITY</span>
        <input type="range" min="0" max="1" step="0.1" value="1" oninput="updateOpacity(this.value)" onmouseup="this.blur()">
    </div>
    
    <div id="shape-color-ctrl" style="display:none; flex-direction:column; align-items:center;">
        <span class="label">COLOR</span>
        <input type="color" oninput="updateShapeColor(this.value)" class="color-input">
    </div>

    <div id="text-font-ctrl" style="display:none; gap:10px; align-items:center;">
        <div style="display:flex; flex-direction:column; align-items:center;">
            <span class="label">FONT</span>
            <select class="font-select" onchange="updateFont(this.value)">
                <option value="'KG Red Hands', sans-serif">KG Red Hands</option>
                <option value="Bangers">Bangers</option>
                <option value="'Fredoka One', cursive">Fredoka (Bold)</option>
                <option value="'Short Stack', cursive">Short Stack</option>
                <option value="'Patrick Hand', cursive">Patrick Hand</option>
            </select>
        </div>
        <div style="display:flex; flex-direction:column; align-items:center;">
            <span class="label">TEXT COLOR</span>
            <input type="color" id="text-color-picker" oninput="updateTextColor(this.value)" class="color-input">
        </div>
    </div>

    <button class="btn-dark btn" onclick="transform('flipH'); this.blur();">Flip</button>
    
    <div style="display:flex; gap:2px;">
        <button class="btn-dark btn" title="Move to Back" onclick="changeZIndex('back')">↘</button>
        <button class="btn-dark btn" title="Move Down" onclick="changeZIndex('down')">↓</button>
        <button class="btn-dark btn" title="Move Up" onclick="changeZIndex('up')">↑</button>
        <button class="btn-dark btn" title="Move to Front" onclick="changeZIndex('front')">↗</button>
    </div>

    <button class="btn" style="background:#ff453a" onclick="deleteObj(); this.blur();">Del</button>
    <div class="pill-handle"></div>
</div>

<div id="left-panel" class="pill-menu dir-col">
    <span class="label">Characters</span>
    <button class="btn" onclick="document.getElementById('char-up').click(); this.blur();">+ Upload</button>
    <input type="file" id="char-up" multiple hidden onchange="handleLibraryUpload(this, 'cast-dock')">
    <div id="cast-dock" class="library-scroll" style="margin-top:10px;"></div>
    <div class="pill-handle"></div>
</div>

<div id="stage">
    <div id="canvas" onmousedown="deselect(event)">
        <div id="canvas-bg" style="position:absolute; inset:0; pointer-events:none; background-size:cover; background-position:center;"></div>
        <div id="objects-layer"></div>
    </div>
</div>

<div id="right-panel" class="pill-menu dir-col">
    <span class="label">Scenery</span>
    <div style="display:flex; gap:4px; margin-bottom:5px;">
        <button class="btn-dark btn" style="flex:1" onclick="document.getElementById('bg-up-lib').click(); this.blur();">+ Background</button>
        <button class="btn" style="background:#ff453a; padding: 8px;" title="Remove Background" onclick="applyBG(''); this.blur();">Clear BG</button>
    </div>
    <input type="file" id="bg-up-lib" multiple hidden onchange="handleLibraryUpload(this, 'bg-dock', true)">
    <div id="bg-dock" class="library-scroll" style="max-height: 80px;"></div>
    
    <span class="label" style="margin-top:15px">Objects</span>
    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:4px;">
        <button class="btn-dark btn" onclick="spawn('shape', 'rect'); this.blur();">Box</button>
        <button class="btn-dark btn" onclick="spawn('shape', 'circle'); this.blur();">Circle</button>
    </div>

    <button class="btn" style="margin-top:10px" onclick="spawn('text'); this.blur();">Add Text</button>
    
    <span class="label" style="margin-top:15px">Layers (Drag to move)</span>
    <div id="layer-container"></div>

    <div style="margin-top:auto; display:flex; flex-direction:column; gap:6px;">
        <button class="btn" style="background:#34C759;" onclick="duplicateCurrentPage(); this.blur();">Duplicate Page</button>
        <button class="btn" style="background:#007AFF;" onclick="addNewPage(); this.blur();">+ New Page</button>
        <button class="btn" style="background:#ff453a; opacity: 0.8;" onclick="deleteCurrentPage(); this.blur();">Delete Current Page</button>
    </div>
    <div class="pill-handle"></div>
</div>

<script>
    let pages = [ { html: "", bg: "", layers: "" } ];
    let currentPageIdx = 0;
    let selectedEl = null;

    const layerSortable = Sortable.create(document.getElementById('layer-container'), {
        animation: 150,
        onEnd: function() {
            reorderElementsFromLayers();
        }
    });

    function initRibbonSystem() {
        document.querySelectorAll('.pill-menu').forEach(pill => {
            let isDragging = false, isResizing = false;
            let startX, startY, startW, startH, origX, origY;
            pill.addEventListener('mousedown', (e) => {
                if (e.target.classList.contains('pill-handle')) isResizing = true;
                else if (!['BUTTON', 'INPUT', 'SELECT', 'OPTION', 'DIV'].includes(e.target.tagName) || e.target.classList.contains('pill-menu')) {
                    isDragging = true;
                    pill.classList.add('active-drag');
                } else return;
                startX = e.clientX; startY = e.clientY;
                startW = pill.offsetWidth; startH = pill.offsetHeight;
                origX = pill.offsetLeft; origY = pill.offsetTop;
                pill.style.transition = "none";
            });
            window.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    pill.style.left = (origX + (e.clientX - startX)) + 'px';
                    pill.style.top = (origY + (e.clientY - startY)) + 'px';
                }
                if (isResizing) {
                    pill.style.width = (startW + (e.clientX - startX)) + 'px';
                    pill.style.height = (startH + (e.clientY - startY)) + 'px';
                }
            });
            window.addEventListener('mouseup', () => {
                isDragging = isResizing = false;
                pill.classList.remove('active-drag');
                pill.style.transition = "var(--anim)";
            });
        });
    }

    function spawn(type, content, x=100, y=100) {
        const id = 'obj_' + Date.now();
        const el = document.createElement('div');
        el.className = 'element';
        el.id = id;
        el.style.left = x + 'px'; el.style.top = y + 'px'; 
        el.style.width = (type==='text' ? '200px' : '150px');
        el.dataset.type = type; el.dataset.rot = 0; el.dataset.sx = 1;
        el.style.zIndex = document.getElementById('objects-layer').children.length + 1;

        if(type === 'img') el.innerHTML = `<img src="${content}">`;
        else if(type === 'text') el.innerHTML = `<div contenteditable="true" style="font-family:'KG Red Hands', sans-serif; font-size:24px; color:#000; outline:none; text-align:center;">TEXT...</div>`;
        else if(type === 'shape') {
            el.style.height = "100px"; el.style.backgroundColor = "#000";
            if(content === 'circle') el.style.borderRadius = "50%";
        }

        el.innerHTML += `<div class="resizer"></div><div class="rot-handle"></div>`;
        document.getElementById('objects-layer').appendChild(el);
        attachElementLogic(el);
        addLayerUI(id, type);
        select(el);
    }

    function addLayerUI(id, type) {
        const container = document.getElementById('layer-container');
        const item = document.createElement('div');
        item.className = 'layer-item';
        item.dataset.id = id;
        item.innerHTML = `<span>${type.toUpperCase()}</span><small style="opacity:0.5">#${id.slice(-4)}</small>`;
        item.onclick = (e) => { e.stopPropagation(); select(document.getElementById(id)); };
        container.prepend(item); 
        reorderElementsFromLayers();
    }

    function reorderElementsFromLayers() {
        const layerItems = Array.from(document.querySelectorAll('.layer-item')).reverse();
        layerItems.forEach((item, index) => {
            const el = document.getElementById(item.dataset.id);
            if(el) {
                el.style.zIndex = index + 1;
            }
        });
    }

    function attachElementLogic(el) {
        let m = false, r = false, ro = false, px, py, pw, ph, moved = false;
        el.onmousedown = (e) => {
            e.stopPropagation();
            select(el);
            if(e.target.contentEditable === "true") return;
            px = e.clientX; py = e.clientY; 
            pw = el.offsetWidth; ph = el.offsetHeight;
            moved = false;
            if(e.target.classList.contains('resizer')) r = true;
            else if(e.target.classList.contains('rot-handle')) ro = true;
            else m = true;
            const move = (ev) => {
                if (!moved && Math.abs(ev.clientX - px) < 3 && Math.abs(ev.clientY - py) < 3) return;
                moved = true; ev.preventDefault();
                if(m) {
                    el.style.left = (el.offsetLeft + (ev.clientX - px)) + "px";
                    el.style.top = (el.offsetTop + (ev.clientY - py)) + "px";
                    px = ev.clientX; py = ev.clientY;
                }
                if(r) {
                    el.style.width = Math.max(30, pw + (ev.clientX - px)) + "px";
                    if(el.dataset.type === 'shape') el.style.height = Math.max(30, ph + (ev.clientY - py)) + "px";
                }
                if(ro) {
                    const rect = el.getBoundingClientRect();
                    const angle = Math.atan2(ev.clientY - (rect.top + rect.height/2), ev.clientX - (rect.left + rect.width/2));
                    el.dataset.rot = (angle * 180 / Math.PI) + 90;
                    el.style.transform = `rotate(${el.dataset.rot}deg) scaleX(${el.dataset.sx})`;
                }
            };
            const up = () => { 
                window.removeEventListener('mousemove', move); 
                window.removeEventListener('mouseup', up);
                m = r = ro = false;
            };
            window.addEventListener('mousemove', move);
            window.addEventListener('mouseup', up);
        };
    }

    function select(el) {
        if(selectedEl) selectedEl.classList.remove('selected');
        document.querySelectorAll('.layer-item').forEach(i => i.classList.remove('active'));
        
        selectedEl = el;
        if(!el) {
            document.getElementById('edit-ribbon').style.display = 'none';
            return;
        }

        selectedEl.classList.add('selected');
        const activeLayer = document.querySelector(`.layer-item[data-id="${el.id}"]`);
        if(activeLayer) activeLayer.classList.add('active');

        document.getElementById('edit-ribbon').style.display = 'flex';
        document.getElementById('shape-color-ctrl').style.display = (el.dataset.type === 'shape') ? 'flex' : 'none';
        document.getElementById('text-font-ctrl').style.display = (el.dataset.type === 'text') ? 'flex' : 'none';
        
        const slider = document.querySelector('#edit-ribbon input[type="range"]');
        slider.value = el.style.opacity || 1;

        if(el.dataset.type === 'text') {
            const currentColor = el.querySelector('div').style.color;
            document.getElementById('text-color-picker').value = rgbToHex(currentColor) || "#000000";
        }
    }

    function rgbToHex(rgb) {
        if(!rgb) return "#000000";
        if(rgb.startsWith('#')) return rgb;
        const parts = rgb.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);
        if(!parts) return "#000000";
        delete(parts[0]);
        for (let i = 1; i <= 3; ++i) {
            parts[i] = parseInt(parts[i]).toString(16);
            if (parts[i].length == 1) parts[i] = '0' + parts[i];
        }
        return '#' + parts.join('');
    }

    function deselect(e) {
        if(!e || e.target.id === 'canvas' || e.target.id === 'canvas-bg') {
            select(null);
        }
    }

    function changeZIndex(action) {
        if(!selectedEl) return;
        const layerItem = document.querySelector(`.layer-item[data-id="${selectedEl.id}"]`);
        const container = document.getElementById('layer-container');
        
        if(action === 'up' && layerItem.previousElementSibling) container.insertBefore(layerItem, layerItem.previousElementSibling);
        if(action === 'down' && layerItem.nextElementSibling) container.insertBefore(layerItem.nextElementSibling, layerItem);
        if(action === 'front') container.prepend(layerItem);
        if(action === 'back') container.appendChild(layerItem);
        
        reorderElementsFromLayers();
    }

    function updateShapeColor(val) { if(selectedEl && selectedEl.dataset.type === 'shape') selectedEl.style.backgroundColor = val; }
    function updateFont(val) { if(selectedEl && selectedEl.dataset.type === 'text') selectedEl.querySelector('div').style.fontFamily = val; }
    function updateTextColor(val) { if(selectedEl && selectedEl.dataset.type === 'text') selectedEl.querySelector('div').style.color = val; }

    function handleLibraryUpload(input, targetId, isBG = false) {
        Array.from(input.files).forEach(file => {
            const r = new FileReader();
            r.onload = (e) => {
                const img = document.createElement('img');
                img.src = e.target.result;
                img.className = 'lib-thumb';
                img.onclick = () => isBG ? applyBG(e.target.result) : spawn('img', e.target.result);
                document.getElementById(targetId).appendChild(img);
            };
            r.readAsDataURL(file);
        });
    }

    function applyBG(url) {
        document.getElementById('canvas-bg').style.backgroundImage = url ? `url(${url})` : "none";
        pages[currentPageIdx].bg = url;
    }

    function transform(act) {
        if(!selectedEl) return;
        if(act === 'flipH') { selectedEl.dataset.sx *= -1; selectedEl.style.transform = `rotate(${selectedEl.dataset.rot}deg) scaleX(${selectedEl.dataset.sx})`; }
    }

    function deleteObj() { 
        if(selectedEl) { 
            const layer = document.querySelector(`.layer-item[data-id="${selectedEl.id}"]`);
            if(layer) layer.remove();
            selectedEl.remove(); 
            select(null); 
        } 
    }
    
    function updateOpacity(v) { if(selectedEl) selectedEl.style.opacity = v; }
    
    function saveState() { 
        if (currentPageIdx === -1) return;
        pages[currentPageIdx].html = document.getElementById('objects-layer').innerHTML; 
        pages[currentPageIdx].layers = document.getElementById('layer-container').innerHTML;
        const bg = document.getElementById('canvas-bg').style.backgroundImage;
        pages[currentPageIdx].bg = bg.replace('url("', '').replace('")', '');
    }

    function jumpToPage(idx) {
        if(idx < 0 || idx >= pages.length) return;
        saveState(); select(null);
        currentPageIdx = idx;
        
        document.getElementById('objects-layer').innerHTML = pages[idx].html || "";
        document.getElementById('layer-container').innerHTML = pages[idx].layers || "";
        
        const bgLayer = document.getElementById('canvas-bg');
        if (pages[idx].bg && pages[idx].bg !== "none" && pages[idx].bg !== "") {
            bgLayer.style.backgroundImage = `url(${pages[idx].bg})`;
        } else {
            bgLayer.style.backgroundImage = "none";
        }
        
        document.querySelectorAll('.element').forEach(el => attachElementLogic(el));
        
        document.querySelectorAll('.layer-item').forEach(item => {
            item.onclick = (e) => { 
                e.stopPropagation(); 
                select(document.getElementById(item.dataset.id)); 
            };
        });

        rebuildDots();
        reorderElementsFromLayers();
    }

    function rebuildDots() {
        const container = document.getElementById('dot-container');
        container.innerHTML = '';
        pages.forEach((_, i) => {
            const dot = document.createElement('div');
            dot.className = 'page-dot' + (i === currentPageIdx ? ' active' : '');
            dot.onclick = () => jumpToPage(i);
            container.appendChild(dot);
        });
    }

    function addNewPage() { 
        saveState(); 
        pages.push({ html: "", bg: "", layers: "" }); 
        jumpToPage(pages.length - 1); 
    }

    function duplicateCurrentPage() { 
        saveState(); 
        const clone = JSON.parse(JSON.stringify(pages[currentPageIdx])); 
        pages.splice(currentPageIdx + 1, 0, clone); 
        jumpToPage(currentPageIdx + 1); 
    }

    function deleteCurrentPage() {
        if (pages.length <= 1) {
            pages[0] = { html: "", bg: "", layers: "" };
            currentPageIdx = 0;
        } else {
            pages.splice(currentPageIdx, 1);
            currentPageIdx = Math.max(0, currentPageIdx - 1);
        }
        const target = currentPageIdx;
        currentPageIdx = -1; // Force full refresh
        jumpToPage(target);
    }

    async function exportPDF() {
        saveState(); select(null);
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF('p', 'px', [595, 842]);
        for (let i = 0; i < pages.length; i++) {
            const tempDiv = document.createElement('div');
            tempDiv.style.cssText = "width:595px; height:842px; position:absolute; left:-9999px; background:white; overflow:hidden;";
            
            let bgImg = (pages[i].bg && pages[i].bg !== "none") ? 
                `<img src="${pages[i].bg}" style="position:absolute; width:100%; height:100%; object-fit:cover;">` : "";
            
            tempDiv.innerHTML = `${bgImg}<div style="position:absolute; inset:0; z-index:1;">${pages[i].html}</div>`;
            document.body.appendChild(tempDiv);
            
            tempDiv.querySelectorAll('.resizer, .rot-handle').forEach(h => h.remove());
            
            const canvas = await html2canvas(tempDiv, { scale: 2 });
            pdf.addImage(canvas.toDataURL('image/png'), 'PNG', 0, 0, 595, 842);
            if (i < pages.length - 1) pdf.addPage();
            document.body.removeChild(tempDiv);
        }
        pdf.save('Comic_Masterpiece.pdf');
    }

    initRibbonSystem();
</script>
</body>
</html>